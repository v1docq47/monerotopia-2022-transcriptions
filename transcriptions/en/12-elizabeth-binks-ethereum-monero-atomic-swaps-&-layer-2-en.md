# Elizabeth Binks

_**Elizabeth Binks on Ethereum-Monero Atomic Swaps & Layer 2 – Monerotopia 2022**_

_Introduction - Elizabeth Binks, Software Engineer and Blockchain Protocol Developer for 4+ years, speaks about ETH-XMR Atomic Swaps, Monero Interoperability & Layer 2, at the Monerotopia 2022 #XMR4ALL event! (She will be sharing a better video of the Demo Ethereum-Monero Atomic Swaps with us - we will post the link soon!)_

[https://youtu.be/1u0VfkYuXu8](https://youtu.be/1u0VfkYuXu8)

---

_**Elizabeth:**_ Hello everyone. So I’m Elizabeth and I’m going to be presenting today on ETH-Monero atomic swaps as well as privacy concerns related to atomic swaps. So I’m also going to be doing a live demo. So I’ve been working on the implantation of this, and I’m going to do a live demo on stagenet during this presentation. Okay, thank you.

So yeah a little bit about me. So, my name’s Elizabeth, like I said I’ve been a blockchain protocol level developer for slightly over four years now. So kind of started off on like the Ethereum solidity side, and then since then worked on a few various different like blockchain node implementations so like Polkadot, Cosmos, Avalanche and the Filecoin Rust implementation. And yeah, and I’ve kind of always had an interest in privacy, that’s kind of how I got into Monero. I did a project in my undergrad on trying to add more privacy to Ethereum, basically throwing ring signatures onto Ethereum, but didn’t really go anywhere, because the gas fees were really, the block gas limit was too low essentially to do it. But that’s kind of how I got into all the Monero crypto stuff.

So a little demo. I’m sorry, so the summary of what I’m going to do. So first I’m going to start a demo for stagenet. So if anyone doesn’t know, stagenet is basically like mainnet Monero, but with no value. So I’m going to start a demo for that, and it’s probably going to take around 20 minutes ideally. So I’m going to first start it and then at the end we’ll look at it again, and then I’m going to go over the motivation for the project development progress, and protocol deep dive maybe, if I have time, I might move it up to the end. And then yeah mostly privacy and security implications, and then yeah just next steps for the project.

So I’m gonna start the demo. I have to seat here, because HDMI is very short. Yeah so if you guys don’t know, basically atomic swaps are a trustless peer-to-peer swap between only two parties. So basically I’m going to demo a swap between a party that holds ETH on the Goerli network, which is a testnet for Ethereum, and then I’m also, and then there’s gonna be another part that holds stagenet Monero, and they’re gonna do an atomic swap. So yeah, so let’s, so I’m just going to start this right now. Okay, so sorry, first I’m going to actually make my terminal bigger. Okay, cool.

So first I’m going to go into a remote node. So I’m going to do it like how it would probably be done in real life. So you would basically have some remote Monero provider, and then a for example like an ETH offer taker on your local machine essentially. So let me just… I hope you guys can see the term. I’m going to show you why also so it’s not going to be like all terminal. So first I’m just going to start a node on my remote machine that is going to be the Monero provider, which we’re gonna just call Bob. So, oops, so essentially the Monero provider has a Monero wallet, CLI wallet, open with access to Monero. It has access also to an Ethereum key and an Ethereum endpoint obviously. And as well there’s already the swap contract that’s been deployed on the Goerli network, so it’s gonna also just use that.

The machine’s really slow. Okay, cool. So I’m then going to start another node on my machine. And these are just like swap nodes essentially. So they’re just part of the peer-to-peer network. So yeah, so I’m just making sure. So yeah, so I’m gonna now start the Alice node which is the ETH holder. Same idea — it has like an Ethereum private key that holds the testnet Ether, and it’s just going to connect to the remote node. So yeah, I just started it right now, yeah. So they should hopefully connect. Yeah, okay, peer-to-peer one, okay cool. So and then I’m just gonna start a third node, that’s just gonna like be there, but it’s not going to actually do, it’s not going to take part of the swap. It’s just going to essentially so I can show on the UI that there’s going to be multiple offers. So I’m just going to start that in the background as well, okay, cool.

So now I’m going to make an offer on the remote node. Sorry, can you hold this for a second? Thanks, sorry, to get the IP again. This is a little squished I think. So I’m gonna move these to another terminal or another work screen, okay, cool. So I’m just going to make the offer now. Where is it? Okay, so cool. So it’s going to make an amount, it’s going to make an offer, it’s going to connect to this Bob remote node. The offer is going to have a minimum amount of 0.1 Monero, maximum amount of seven. So for example like if you only have seven Moneros, you would put that as the max amount. It’s going to have a certain exchange rate, so basically the ratio that you want to swap. So yeah I’m just gonna make it and… okay that’s not supposed to happen. Is my node working? Okay I’m just gonna reduce the maximum amount, because I feel like maybe I did too many before and now I’m running out of amount. Okay, I think I just didn’t have enough stake at Monero, okay we’re good, cool.

Okay, so now I’m going to, yeah, I’m just going to start the UI now. So, okay, I’m starting the UI and then it should connect to my, the node on my machine, and oops… And then it’s just running on a local port. So right now it should just show one peer and one offer, yeah, okay, cool. So that’s my offer and I’m just going to, on here, I’m just going to show that basically you can have like multiple offers. One second. I have a lot of terminals. Wait, sorry. Basically… okay, cool. So there should be another offer up. Okay, let’s refresh, hopefully it shows up. Oh, okay wait. I kind of messed up. It’s right now making. Okay whatever there’s two offers essentially, but they’re just for the exact same amount. So it’s like overlapping, but anyways. Let me just cancel that. Sorry let me redo that. So I’m gonna make this one having a different amount. Okay, refresh, this now should be better. Yeah, okay, cool. Okay, so now you can see the two distinct offers.

Okay, so now I’m just gonna start the actual swap process. There’s a lot of setup because I’m running all the nodes, normally there wouldn’t be that much setup used. You just would open the UI essentially. And yeah and right now the private keys are on the backend, but we want to essentially put a MetaMask integration, so you can assign with your MetaMask. So it’s all in your browser. So yeah I’m just gonna swap .05 ETH for one Monero hit swap. And then it should we sort of see in the logs that it initiated. Okay, cool, so it initiated. And then it should show, where’s my other one here, okay, yeah, so we can see that the stage is being updated. So I’m gonna leave this now to run for about 20 minutes, because stagenet blocks can take a while so that’s why it takes so long. And yeah I’m just going to go back to my presentation. Cool okay, so everyone pray for the demo. Sorry I forgot full screen.  Okay, cool. Can you go for it. Thanks. Cool, okay.

So a bit about the why that I started this project. Currently there’s a few methods you could use to essentially get Monero. So one of them is basically a centralized exchange which is probably, I don’t know, it’s probably one of the easiest amounts, oh sorry, easiest ways to get Monero. However obviously this is not really a good solution for long term, because it’s centralized, it’s trusted, it’s custodial, basically it’s not private at all. Everything, everything about yourself is revealed to the exchange, because they’re gonna want KYC and all that kind of stuff. Maybe one day they’ll decide that, the government decides to crack down and say: “No more privacy coins on centralized exchanges”. We’re already kind of seeing that, to be honest. So yeah, this is not really a good solution for long term.

And then yeah there’s also like bridges which are often used, but as far as I know, there aren’t really any Monero bridges that are currently working. Bridges kind of range from centralized to decentralized and level of privacy is okay depending on like what the parties you’re swapping with. But generally on the non-private chain your addresses and the amounts that are swapped are going to be revealed. And yeah usually with bridges they have like a third party like relayers and that kind of thing. So yeah there’s a third party. But for atomic swaps, I would say, that it’s most similar to, for example, like a LocalMonero type situation, except on your computer. So it’s basically like the optimal amount or, I’m not gonna say optimal, but it’s a much better amount of privacy — it’s decentralized, it’s trustless, it’s totally peer-to-peer, there’s just two parties — you and the other person. Yeah I don’t really have to rely on anyone. So basically in general your addresses and the amounts are going to be still revealed on the chain, that is not private by default. So for example. if you swap like ETH to Monero, or Bitcoin to Monero, like on the ETH or Bitcoin side like it’s not private at all still. But maybe there could be ways to prevent this. Okay, cool.

So yeah, so why Ethereum? So basically Ethereum is the largest blockchain by usage. It’s number two by market cap, like it’s huge, it’s easy to get ETH, same with Bitcoin, like you can just go to an ATM or like whatever place that sells crypto and you just buy it. It’s way easier to get your ETH on than Monero unfortunately. So basically by having an atomic swap between ETH and Monero it greatly increases the accessibility. So like in the scenario I previously mentioned where centralized exchanges decide to ban privacy coins or whatever privacy coins become really hard to get. Atomic swaps are going to be a pretty needed method for obtaining them. And then also there’s, I don’t know, potentially maybe an ability to integrate it directly with DeFi, because as we all know Ethereum is the home of DeFi and, I don’t know, tokens, NFTs all that like fun jazz. So there might be a way to yeah it would essentially make it easier to on-ramp to those kind of things.

So the project. So I started this project back in October. So basically the project is… first I created the protocol for Ethernet atomic swaps. It essentially uses a smart contract as the sort of heavy lifting. So it manages like the claim and refund functionalities. And I guess like personally like this is something I would use, like I know a lot of people that would use it. So I think that it’s something that will be very handy. And the currently implementation that I’m working on is being written in Go. So Go is kind of, I don’t know, newer iSH systems language. It has really nice concurrency primitives, I really like it. It’s easy to read, it’s easy to learn, so I figured that also writing it in a more accessible language would be really nice as opposed to something more like esoteric maybe.

So some notable code-based features that I’ve added so far. So that I added a Go ed25519 library for Monero, like addresses and signing, and that kind of stuff, private key management. There wasn’t really anything like this in Go. So I think hopefully it will be useful if someone wants to develop Monero stuff in Go. And then also I added a networking layer so it’s using a library called libp2p, which is an open source peer-to-peer library for networking. I really like it. So it includes also a DHT for peer discovery. So this is a distributed hash table. I’m going to go into it more later, what it’s used for. But essentially you can discover peers and offers on the network in a decentralized manner.

So development progress. So I think back in December I started the CCS process for this, and I think in January it got funded and accepted. So first of all, thank you everyone for funding it, huge thank you for the community. So some of the development progress that I’ve done so far. So in the milestone, oh in the CCS there’s seven milestones. So the first four are essentially done or mostly done.

So quickly: so the first one is  essentially feature completion and just unit tests, and that kind of thing so this was implementing like the refund paths, like a little recovery module in case like your node crashes halfway through or something like that. So that’s done.

The second is a swap contract. I’m going to call it “factory” essentially for gas savings. So gas is like a meter of I don’t know how much stuff costs on Ethereum. So basically less gas equals cheaper. So in the very first iteration the swap contract was just like a one-time thing that you had to deploy every time. But that’s pretty expensive to deploy a contract, especially if a lot of it is going to be the same every time. So the milestone 2 essentially turned it into one contract that’s deployed once on chain by whoever and then from there you can just call a function in it to easily instantiate a new swap. So it saves a lot of gas, because you don’t want to deploy something every time. It’s probably like 3x cheaper or something like that I think to start a swap.

And then the third one is something called discrete logarithm equality integration also for gas saving. So this is kind of a protocol update to the swap. So it essentially allows you to verify secp keys on the contract instead of ed25519 keys which are happening before. So if anyone doesn’t know secp is native to Ethereum, ed2509 is what Monero uses, so it’s essentially a lot cheaper to use secp on Ethereum, just because like there’s built-ins essentially for it. So that’s what the second milestone does. I’m gonna I said it’s mostly done, because it’s done in the code base but it uses on the backend of Rust library to do the proofs, and I wanted to do a Go implementation of it as well, just because it’ll be nicer to maintain, don’t have to deal with like funny language bindings and that kind of thing.

And then fourth milestone, integration testing. So this is basically like automated tests that run like two nodes and go through all the success and refund et cetera, and go through all the success and refund paths. This is done.

And then the fifth one is stagenet testing. So basically deploying a bunch of nodes on remote servers and just doing some automated testing on them,  just like running a bunch of swaps for like a long period of time, kind of making sure everything is good, nothing funny is happening.

And then also in six is going to be research for SwapV2. So this is hopefully going to be an improved protocol with improved privacy and more features, like maybe token integration. So I’m going to talk a lot more about this part later, because this is what I’ve been researching.

And then the seventh one is just a UI. So I showed you the UI later, oh earlier, but we’re essentially just going to make it really nice — put MetaMask into it. Can you skip to the end of this? I have a bunch of slides on the protocol detail, but we don’t have time for it. So we’ll see if we have time after my talk.

So I think… privacy for atomic swap. So since we’re all here, we obviously all like privacy. So you might be wondering how is your privacy preserved in an atomic swap. So this is something that I’m pretty interested in researching. So for privacy we essentially want to have three different components that are satisfied. So the first one is anonymity. So basically just hiding who participated in the swap. So in this case it would be the addresses. Confidentiality which is hiding the amounts that are swapped. So Monero has this by default, but other chains do not. And then indistinguishability which is hiding that a swap happened at all. So making the swap transaction look the exact same as any other transaction.

So how do current atomic swaps measure up to these. So on the Monero side they’re basically satisfied because of the fact that Monero is private by default. But on the, for example, the Bitcoin-Monero atomic swaps or ETH-Monero atomic swaps, on the Bitcoin or ETH side that doesn’t have privacy, these aren’t really satisfied at all. So how might we satisfy them? That’s a question.

And then another concern is also network level privacy versus chain level privacy. So what information can you determine from looking at the swap network and seeing on the peer-to-peer level like what’s happening. So, for example, like what metadata can be leaked from watching the swap network? So one method that could be used to potentially link a transaction on a transparent chain like Ethereum versus one like Monero would be like timing correlations. So, for example, you see like someone makes an offer, someone else takes it, and then like right after you see these two transactions on both chains, you can probably correlate to somewhat of a high degree that there is atomic swap happening there, especially if you can correlate like someone’s IP that’s on the network with an address or something like that. So that’s kind of concerning.

And then also who’s interested in getting Monero or who’s interested in getting ETH, basically I’m going to talk about this a bit more later, but you can basically find out everyone who’s on the network, who’s doing this, as well as amounts that people are offering to swap. So from that you can basically like extrapolate that someone has at least this much, unless they’re like a malicious node that’s just like on there for whatever reason don’t actually have that much.

So how does this, oh yeah, and then on the chain level I think I have another slide for that after, but so essentially how does this affect the privacy of those doing swaps. So the first concern is linkability. Please, next slide. So basically for example on Ethereum in the swap contract you have to unfortunately have ETH to get more ETH due to the fact that you have to pay gas fees to call the function that will let you claim the ETH. So this is pretty bad because you can link two Ether accounts together, like if you try to do it from two separate accounts, obviously it’s probably you again. And then you can like I said earlier with timing correlations, you can link two transactions on different chains, and maybe you can from the swap, from seeing how much ETH someone received, you can infer how much Monero other person received as well. So that’s some linkability concerns.

And then another factor that’s pretty important in the privacy, I would say, is how you actually find the offers on the network. So there’s a couple of ways that a swap provider can advertise themselves. So the first most obvious but centralized solution is to just have a website, so you can just publish on this website that you’re making an offer. So this is obviously centralized, because it’s on someone’s website, like maybe you could I, don’t know, have a bunch of people hosting the website, but essentially it’s centralized. And this also makes you kind of vulnerable to phishing attacks, because people might just… I don’t try to phish people, send them a fake swap website, and then just grief them or whatever. So yeah not really that great of solution for advertisement of the offers. As well it’s really easy to see like all the offers, because they’re just like on this website.

And then another, a couple of another methods that you could use are a DHT, a distributed hash table. So a distributed hash table is like a decentralized peer-to-peer table that’s used for content storing and lookup. Usually in the blockchain context this is used for peer discovery, in the atomic swap implementation that I’m doing right now, I’m using it for both peer discovery and also offer discovery. So if someone wants to make an offer they publish it into the DHT. This way it’s just decentralized, it’s uncensorable. Like on a website someone could just censor it, if they don’t want you to partake. It’s pretty good. It somewhat protects against attacks where someone might try to look through all the offers in the network, you would probably be able to find them all, but there isn’t a guarantee that you would be able to find them all.

And then yeah another method could be a gossip network. So this is essentially just you would have a DHT for only peer discovery, and then after you discover the peers you would just send messages around the network offering swaps and taking them. So this is also kind of nice, it’s decentralized as well, also peer-to-peer, but there’ll just be more, potentially more message latency, potentially... it’s just not as simple to implement like a bit of a messaging protocol. but might potentially protect against enumeration concerns, which is in the next slide.

So enumeration is basically a metadata leakage, where you can find everyone on the network and all their IPs. So on a website pretty trivial to do that on a DHT. It’s like not as trivial, but you can still do it. And then, what else, and then on the gossip network this might be harder, because maybe, I don’t know, maybe you say, you should put on a message saying: “I’m looking for these offers”, and only maybe a few people reply and everyone replies like something like that. But either way it’s kind of concerning, because you can usually just like put all these IPs in a table and say: “These are all the people with Monero”, or something like that.

And then so other, so potential attacks due to centralization. So this is sort of relating to like just advertising on a website. You could maybe make a bajillion like false offers and grief people. So the way the protocol works is that the ETH holder has to lock their ETH first, and as we all know ETH gas fees are kind of high, especially at certain times, so an attack could be like makeup bajillion Monero offers saying like: “Oh, I have this Monero, I want ETH”, get people to lock ETH and then basically the swap will timeout, and then the refund path will trigger. But this person has now lost gas. And if you do that like a lot of times, it would basically make them run out of funds. So basically yes this is kind of hard to do with a decentralized method which is nice, because you would essentially have to cut them off from the rest of the network, so they wouldn’t be able to find any other providers apart from your like evil providers, So say you’re like on the network, you’re node with ETH, you want Monero, so maybe you’re on, if you’re on a phishing website this is pretty easy, because then all those offers would be fake, and someone can just grief you, but if you’re on a decentralized P2P network this would be a lot harder, because DHTs, for example, a lot of gossip algorithms have methods that prevent eclipse attacks built in. So an eclipse attack is essentially like when your node gets segregated from the rest of the network, and it’s only connected to malicious nodes. So overall I think depending on this is like concerns that are unrelated to the swap protocol itself, and more just related to like the actual implementation of it. And I think that’s pretty important to consider.

So what else? So yeah, on some goals for privacy. So on the network level a few things could be done to add more privacy. So the first one is just sender-recipient anonymity. Basically saying that like if you send someone message, they shouldn’t know who you are, and you shouldn’t know who they are, like the IPs should be hidden. And then anonymity of swap providers, so you shouldn’t be able to easily go through the network, find everyone who’s a provider on the network. Same with lookups or queries for providers, shouldn’t be able to easily find everyone who’s querying on the network. Confidentially, confidentiality of swap amounts. So right now when you advertise an offer you save the amounts as well. Ideally you would not have to do this, you’d be able to do it confidentially somehow.

And then on the chain level there’s a few goals as well. So essentially you want to make, these are basically the same three points I said earlier, so you want to make this to the swap transactions indistinguishable from the others. You want to hide the swap amounts on chain as well. And you want ideally to have anonymity of the swap participants.

So how can we improve the privacy? So on the network level there’s a few things we can do. So very basic is just like use a VPN if you join the network that way your real IP isn’t published on the network. However obviously a VPN is centralized. They still maybe have the logs that kind of thing. So it’s better than just like putting your home IP, for example, but not exactly ideal.

Another one is onion routing. So this is essentially Tor or what Tor uses. So all your network messages are wrapped through a few layers of encryption then get unwrapped. So this hides the sender of a message and the receiver of a message. So having this would be pretty nice, because you don’t have to, you wouldn’t essentially reveal the IPs of who you’re swapping with. As well as if you do like lookups or that kind of thing. So that’s pretty nice. But Tor is still somewhat vulnerable, but like it is vulnerable to like correlation attacks. So essentially like packet size and timing attacks. So while it’s like a pretty, I don’t know, it’s pretty good but not perfect.

And then there’s also mixnet. So mixnet is probably like the most advanced level of network level privacy. So basically all messages are routed through like a mix of nodes. So all the nodes that are being run through are called a mix, and they essentially package different messages together, they hold the messages for maybe some random amount of time, so it’s harder to do timing correlations, you can’t do size correlations as well, since the packets are all like blob together essentially, and they only get unwrapped at the final layer. So essentially a mixnet would be like a very ideal situation in terms of swap privacy or, I don’t know, any sort of privacy on the network level really. But I’m not currently aware at the moment of mixnets that would really be good for atomic swaps. A lot of them are built for sort of other purposes, like secure messaging and that kind of thing like more, I don’t know messenger type things. But yeah something to research for sure.

And then another thing would be like privacy preserving, DHT scheme. So a way to preserve the privacy of people advertising and doing lookups on the DHT. Right now there also isn’t really that much out there on this. So there’s another area that I think would be really good to research. Oh sorry, just keep this one.

And then on the chain level, so a few methods would be, maybe timing delays for on-chain transactions so you can’t easily do timing correlations on the swap transactions. Obviously another one is layer one privacy. So Monero is like pretty good to go in general. Obviously this has L1 privacy, but ETH, Bitcoin don’t. However on Ethereum there are like Rachel mentioned earlier there’s something called ZK-money, which is like a zero knowledge layer 2 privacy solution for Ethereum. So potentially if you could swap into that directly it would preserve the anonymity and confidentiality of your swap. However it might need like contracting functionality or that kind of thing, I’m not sure if that’s released yet. I don’t think it is. So that might not be feasible at the moment, but definitely something that I think would be really nice to implement in the future, just direct swaps for these like private tokens.

And then another thing. The last two are a bit more like research topics. So scriptless swaps. Potentially there could be a way to do an atomic swap without requiring any sort of scripting functionality on other chain. So this would be like the ideal solution in a lot of ways, because it would satisfy indistinguishability, which is that like a swap transaction look the exact same as any others on like both chains, even if the L1 doesn’t have any privacy. Because currently the way it works is that there’s some sort of script on Bitcoin or ETH that performs some sort of like swap related functionality, and you can easily just like look at it and tell that there’s something like that happening. So a skripless swap would essentially remove that on-chain kind of layer that you’ve kind of swapped.

And then a last thing would be multi-party swaps. So maybe potentially, I’m not sure if this is feasible, but this is something interesting, I think, to think about. Potentially having multiple participants in a swap, sort of having like a greater anonymity set for the swap. So you can maybe like have possible designability of who you swapped with and that kind of thing. So it’s just something, I think, would be very cool to research.

And then future work for the implementation that I’m doing. So essentially I would like to work on a or I’ve been working on a version 2 of the protocol with gas improvements, so reducing the amount of stuff that’s happening in the contract on chain to save a lot of fees on the ETH side. Privacy improvements so basically all the stuff I just mentioned, both network level and chain level improvements. Direct swaps for ERC-20. So this is something that people have been pretty interested in, so maybe a way to directly swap for like any sort of ERC-20 maybe even like ERC-721 aka NFTs, I think this is like pretty doable and something that would be pretty valuable, I think, that way you can directly swap from whatever token directly into Monero and same for the other direction. And then network level privacy. So I kind of already mentioned that, but discovery, advertisement, that kind of thing.

So back to the demo. I’m hoping that the swap finished. I don’t know how long it’s been, but we’re gonna look at it and see. Okay it’s still actually running, so I think station is like going really slow today. Okay, my node is synced, but it might take, let me see how long, it’s been since we started. Where is it? I have to scroll up a lot. Okay, here it is. So what time is that? 16:13 and now it’s 16:39. Okay it’s been a long time. Okay, I’m just gonna I guess talk a few more minutes and hopefully, yeah hopefully, that will, I don’t know, finish.

Okay, do anyone know how much time I have left? How much time I have left? Okay, well swap ended up taking really long. So everyone mind some station at please to speed up the chain. So that’s basically it. So if you want you can check out the GitHub, there’s instructions on how to run it, there’s instructions on the protocol in github.com/multi/atomicswap. I have in these slides also like a bunch of stuff on how the protocol works, like nice slides, so I’m going to post that in the repo as well. You can find me on Twitter at ElizabethEthereum. Yeah, cool, thank you everyone for watching.

_**Doug:**_ Awesome. Thank you so much.
